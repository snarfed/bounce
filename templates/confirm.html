{% set body_id = 'confirm' %}
{% extends "base.html" %}

{% block content %}

{% set from_label %}
  {% with auth = from_auth %}{% include 'account_label.html' %}{% endwith %}
{% endset %}

{% set to_label %}
  {% with auth = to_auth %}{% include 'account_label.html' %}{% endwith %}
{% endset %}

{% set bridged_to_label =
     from_label if from_user.HAS_COPIES
     else ('<code>' + to_user_bridged_handle + '</code>')|safe %}

<div class="row big">
<p>Migrate {{ from_label }} to {{ to_label }}
{% if to_auth.pds_url and util.domain_from_link(to_auth.pds_url) not in MAIN_PDS_DOMAINS %}
  on {{ util.pretty_link(to_auth.pds_url)|safe }}{% endif %}?
</div>

<div class="row" style="text-align: left">
<ul>
<li>{{ to_label }} will be <a href="https://fed.brid.gy/docs">bridged</a> back to {{ from_user.PHRASE }} as {{ bridged_to_label }}.
<li>Your followers on {{ from_user.PHRASE }} will all {% if from_user.HAS_COPIES %}continue to{% endif %} follow {{ bridged_to_label }} and continue to see your posts.
<li>{{ to_label }} will follow any accounts {{ from_label }} follows that are bridged to or native to {{ to_user.PHRASE }}.
<li>You won't be able to log into {{ from_label }} and use it interactively any more.
<ul>
</div>


<form action="/migrate" method="post">
<div class="row">
  {% if from_auth.site_name() == 'Bluesky' %}
    <p>We've asked Bluesky to email you a confirmation code. Please enter that code here.
    <p><input required type="text" name="plc_code" id="plc_code"
           placeholder="A1B2C-D3E4F" />
  {% endif %}

  <input type="hidden" name="from" value="{{ from_auth.key.urlsafe().decode() }}" />
  <input type="hidden" name="to" value="{{ to_auth.key.urlsafe().decode() }}" />
  <input type="submit" class="btn btn-danger" value="Migrate" />

  {% if from_auth.site_name() == 'Bluesky' %}
    <p><a href="/bluesky-password?from_auth={{ from_auth.key.urlsafe().decode() }}&to_auth={{ to_auth.key.urlsafe().decode() }}">Click here to send a new code.</a>
  {% endif %}
</div>
</form>

{% endblock content %}
